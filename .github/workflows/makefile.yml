name: Makefile CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    - name: get PMID cache
      run: python3 scripts/pmid_fetch.py --md cv.md --out .cache/pubmed.json

    - run: mkdir -p build
    - uses: docker://pandoc/core:3.8
      with:
        args: >-
          cv.md
          --template=template.tex
          --lua-filter=filters/pmid_citations.lua
          -M pmid_db=.cache/pubmed.json
          -M pmid_style=cv
          -M pmid_authors=6
          --pdf-engine=xelatex
          -o build/cv.pdf
